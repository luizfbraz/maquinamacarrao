<script>
    function enviarResposta(respostas) {
        console.log('Dados a serem enviados:', respostas); // Adiciona um log para verificar os dados
    
        fetch('https://api.github.com/repos/luizfbraz/maquinamacarrao/issues', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer 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',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                title: 'Resposta à Máquina de Macarrão',
                body: JSON.stringify(respostas)
            })
        })
        .then(response => {
            console.log('Resposta do servidor:', response); // Adiciona um log para verificar a resposta do servidor
            if (!response.ok) {
                throw new Error('Erro ao enviar resposta. Resposta do servidor: ' + response.statusText);
            }
            return response.json();
        })
        .then(data => {
            console.log('Resposta enviada com sucesso:', data);
            alert('Resposta enviada com sucesso!');
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao enviar resposta. Verifique o console para mais detalhes.');
        });
    }

    function updatePoints() {
        var form = document.getElementById("questionnaireForm");
        var elements = form.elements;
        var totalPoints = 0;

        for (var i = 0; i < elements.length; i++) {
            if (elements[i].type == "select-one") {
                totalPoints += parseInt(elements[i].value);
            }
        }

        document.getElementById("totalPoints").innerText = totalPoints;
    }

    function submitForm() {
        var form = document.getElementById("questionnaireForm");
        var elements = form.elements;
        var totalPoints = 0;
        var hasUnratedOption = false;

        var respostas = {};

        for (var i = 0; i < elements.length; i++) {
            if (elements[i].type == "select-one") {
                totalPoints += parseInt(elements[i].value);
                respostas[elements[i].name] = elements[i].value;

                if (elements[i].value === "0") {
                    hasUnratedOption = true;
                }
            }
        }

        if (hasUnratedOption) {
            alert("Por favor, avalie todas as opções antes de enviar o formulário.");
        } else if (totalPoints <= 16) {
            alert("Formulário enviado com sucesso!");
            enviarResposta(respostas);
        } else {
            alert("Você ultrapassou o limite de 16 pontos. Por favor, ajuste suas respostas.");
        }
    }
</script>
